### BDD framework training. Framewok introduction

[![N|Solid](https://images.ctfassets.net/fikanzmkdlqn/5NoHRB1q6lrNzSSpekhrG5/cf22f3d7d9e82aed5e79659800458b57/TELUS_TAGLINE_HORIZONTAL_EN.svg)](https://www.telus.com/en/)

##### [Framework documentation](https://github.com/telus/telus-bdd-docs)

In this section you will discover how to set up your workspace with BDD framework.

<img src="https://cdn4.iconfinder.com/data/icons/48-bubbles/48/23.Videos-512.png" width="30px" margin-top="15px"/> [Session video recording](https://drive.google.com/file/d/1mjL3v4qyBD0L0VsVoJi3aSnfL7Sswv7V/view?usp=sharing)

#### Contents:

1. [Work directory walkthrough](#work-directory-walkthrough)
2. [bddConfig file](#bddconfig-file)
3. [dbBootstrap.config file](#dbbootstrapconfig-file)
4. [testOrder.config.json file](#testorderconfigjson-file)
5. [Basic technical explanation](#basic-technical-explanation)

#### Work directory walkthrough

Your project directory after setup will look like this (in terms of framework related files).

```
│   .npmrc
│   bdd.config.json
│   package-lock.json
│   package.json
│
└───bdd
    │   DBBootstrap.config.js
    │   testOrder.config.json
    │
    ├───contexts
    │       Identificators.ts
    │
    ├───features
    └───steps
            index.ts
```

As you can see all framework files except of main config are located in `bdd` folder, it contains:

- `features`, `steps` and `contexts` directories to store accordingly features, steps and contexts
- index.ts file, used to control steps usage by exporting step files from the folder
- Identificators.ts file, used to specify context identificators
- config for database bootstrap
- config for dependent features

We recommend to put all of your business logic code and other files to `src` folder, this way you would have `bdd` folder with framework related files and `src` folder with your code which will be used in steps.

#### bddConfig file

Is the main configuration file of the framework. Config file is autogenerated based on your answers in init, the only required fields are featuresPath, stepsPath and threadsNumber, others are optional, so you can always create this config manually.

```
{
"featuresPath": "./bdd/features",    // path to your features directory
"stepsPath": "./dist/bdd/steps",      // path to your steps directory
"db": {     // database configuration for DB bootstrap
  "user": "",
  "passwd": "",
  "host": "",
  "port": 0
},
"envsPath": "",     // path to your environments directory
"contextsPath": "./dist/bdd/contexts",     // path to your contexts directory
"threadsNumber": 5,     // default number of parallel threads
"testOrderPath": "./bdd/testOrder.config.json",  // path to test order config for dependent features
"bootstrapPath": "./bdd/DBBootstrap.config.js",  // path to DB bootstrap config
"reporters": ["jest-standard-reporter"],  // reporter config
	"uReportConfig": {
		"token": "",
		"project": ""
	},
	"useUReport": true,
	"spinnakerProperties": {
		"pass": "",
		"fail": ""
	},
	"useSpinnaker": true
}
```

Firstly it contains paths to all framework files and directories. If you want to change location of any framework folder or config inside your project, you can do so and just change the relative path in `bdd.config`.

It also contains integrations config sections for uReport and Spinnaker, you can always disable/enable integrations by changing according boolean fields.

_**Note**_: you can modify your `bdd.config` file to be both `.json` and `.js` file, framework would be able to read them.
Json file is more consice and lightweight, but if you need to add some runtime logic to the config, js file is good for this.
e.g. database credentials are stored in process environment, you can access them in js config as follows:
_bdd.config.js_

```javascript
module.exports = {
  featuresPath: "./bdd/features",
  stepsPath: "./dist/bdd/steps",
  db: {
    user: process.env.DB_USER,
    passwd: process.env.DB_PASSWORD,
    host: process.env.DB_HOST,
    port: process.env.DB_PORT,
    database: process.env.DB_NAME,
  },
  recordCases: true,
  envsPath: "",
  contextsPath: "./dist/bdd/contexts",
  threadsNumber: 2,
  bootstrapPath: "./bdd/DBBootstrap.config.js",
  reporters: ["default"],
};
```

#### dbBootstrap.config file

[`dbBootstrap.config.js`](./database-bootstrap.md) file is created automatically if you choose to use database while init.
You can change its location in `bdd.config` file `bootstrapPath` field.
This config is a `.js` file, which exports object with methods, each method is a dbBootstrap.

```javascript
module.exports = {
  opusbootstrap: (params) =>
    `UPDATE opus_migration
    SET migrating = true, modified_date = now()
    WHERE (ecid, location_id, iptv_id) IN (
      SELECT ecid, location_id, iptv_id FROM opus_migration
      WHERE not migrated 
      AND not migrating
      AND not skipped
      AND not failed
      AND env = '${params.bddEnv}'
      LIMIT 1)
    RETURNING *;`,
};
```

#### testOrder.config.json file

[`testOrder.config.json`](./dependent-features.md) file is created automatically if you choose to use dependent features while init.
You can change its location in `bdd.config` file `testOrderPath` field.
This config is a `.json` file, which contains sequences of feature files by their identification tags.

```json
  "@1": ["@1.1", "@1.2"],
  "@2": ["@2.3", "@2.2", "@2.1"]
```

#### Basic technical explanation

BDD framework is Node.js based automation framework, which can be used to automate any process, by describing it with BDD syntax feature file.
A general sequence of framework execution is:

1. Parse feature files into separate scenarios
2. Parse scenarios into separate steps
3. Initializing contexts (Create new instances of each context class and store them in contexts map)
4. Executing database bootstrap (Connecting to database and pulling datasets for executions)
5. Executing Node.js code of steps

BDD framework also supports multiple threads execution, it can stabely work with up to 100 parallel threads with according hardware.
It uses process level scaling to create parallel workers, usinf processes for scaling allows to have **totally isolated environment for each worker**, this reduces risks of data collisions or other possible problems.

Framework has two binaries (commands) inside of the package that you can use in CLI: `bdd-init` and `bdd`. You can read more about them [here](/cli-usage.md).

